<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Borz Marketing Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    {% if session.get('user') %}
    <script src="{{ url_for('static', filename='tab_enforcement.js') }}"></script>
    {% endif %}
    <style>
        /* Dynamic fade duration from config */
        .hero-title {
            transition: opacity {{ slideshow_fade_duration }}ms ease !important;
        }
    </style>
</head>
<body>
    <div class="panel">
        <nav class="navbar">
            <div class="navbar-content">
                <div class="navbar-left">
                    <div class="menu-icon" id="menu-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </div>
                    <div class="navbar-text">
                        <h1 class="navbar-title">Borz Marketing Panel</h1>
                        <p class="navbar-subtitle">Welcome to your marketing automation hub</p>
                    </div>
                </div>
                <div class="nav-right">
                    {% if session.get('user') %}
                        <div class="user-info">
                            {% if session['user'].avatar %}
                                <img src="https://cdn.discordapp.com/avatars/{{ session['user'].id }}/{{ session['user'].avatar }}.png" alt="{{ session['user'].username }}" class="user-avatar">
                            {% else %}
                                <div class="user-avatar-placeholder">{{ session['user'].username[0].upper() }}</div>
                            {% endif %}
                            <div class="user-details">
                                <div class="username">{{ session['user'].username }}</div>
                                <div class="user-id">{{ session['user'].id }}</div>
                            </div>
                        </div>
                    {% else %}
                        <div class="auth-buttons">
                            <a href="{{ url_for('login_page') }}" class="auth-btn login-btn">Login</a>
                            <a href="{{ url_for('signup_page') }}" class="auth-btn signup-btn">Sign Up</a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdown-menu">
                <a href="{{ url_for('home') }}" class="dropdown-item">Home</a>
                <a href="{{ url_for('purchase') }}" class="dropdown-item">Purchase</a>
                {% if session.get('user') %}
                    {% if plan_status and plan_status.has_plan and not (plan_status.plan_id and plan_status.plan_id.startswith('business_')) %}
                        <a href="{{ url_for('panel') }}" class="dropdown-item">Panel</a>
                    {% endif %}
                    {% if has_business %}
                    <a href="{{ url_for('business_management') }}" class="dropdown-item">Business Management</a>
                    <a href="{{ url_for('business_panel') }}" class="dropdown-item">Business Panel</a>
                    {% endif %}
                    <a href="{{ url_for('settings') }}" class="dropdown-item">Settings</a>
                    {% if is_admin_user %}
                    <a href="{{ url_for('admin_panel') }}" class="dropdown-item">Admin</a>
                    {% endif %}
                {% endif %}
                <div class="dropdown-divider"></div>
                <a href="https://discord.gg/KWt6rvCukp" target="_blank" class="dropdown-item discord-item">Discord Server</a>
                {% if session.get('user') %}
                    <a href="{{ url_for('logout') }}" class="dropdown-item logout-item">Logout</a>
                {% endif %}
            </div>
        </nav>

        <div class="panel-container">
            <div class="home-content">
                <div class="hero-section">
                    <h2 class="hero-title" id="hero-title">{{ slideshow_messages[0] }}</h2>
                    <a href="{{ url_for('purchase') }}" class="view-pricing-btn">View Pricing</a>
                    <div class="scroll-indicator" id="scroll-indicator">
                        <span class="scroll-text">Scroll down to view more</span>
                        <div class="scroll-arrow">&#8595;</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Section -->
        <section class="gallery-section">
            <h2 class="gallery-title">Panel Images</h2>
            <div class="gallery-grid">
                <div class="gallery-item" onclick="openLightbox(0)">
                    <img src="{{ url_for('static', filename='image.png') }}" alt="Panel Screenshot 1">
                </div>
                <div class="gallery-item" onclick="openLightbox(1)">
                    <img src="{{ url_for('static', filename='image.png') }}" alt="Panel Screenshot 2">
                </div>
                <div class="gallery-item" onclick="openLightbox(2)">
                    <img src="{{ url_for('static', filename='image.png') }}" alt="Panel Screenshot 3">
                </div>
                <div class="gallery-item" onclick="openLightbox(3)">
                    <img src="{{ url_for('static', filename='image.png') }}" alt="Panel Screenshot 4">
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="about-section">
            <h2 class="about-title">Who are we?</h2>
            <p class="about-description">Introducing the first marketing tool that lets you launch ads across multiple Discord servers at once, saving time, cutting costs, and giving you total control. No more waiting on marketing teams or wasting money on marketing services. Send ads instantly, track results in real time, and remove underperformers from your workflow. Do it yourself with a single click, or upgrade to our Business Plan to manage a team using our panel, assign ads, and gain detailed insights on each members performance. Marketing, simplified, powerful, and designed to deliver results.</p>
        </section>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightboxOnBackground(event)">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
            <button class="lightbox-nav lightbox-prev" onclick="prevImage(event)">&larr;</button>
            <img id="lightbox-img" src="" alt="Panel Screenshot">
            <button class="lightbox-nav lightbox-next" onclick="nextImage(event)">&rarr;</button>
            <div class="lightbox-counter">
                <span id="current-index">1</span> / <span id="total-images">4</span>
            </div>
        </div>
    </div>

    <script>
        // Dropdown menu toggle
        const menuIcon = document.getElementById('menu-icon');
        const dropdownMenu = document.getElementById('dropdown-menu');

        if (menuIcon) {
            menuIcon.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!dropdownMenu.contains(e.target) && !menuIcon.contains(e.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        // Hero text slideshow - uses requestAnimationFrame for background-safe timing
        const heroTitle = document.getElementById('hero-title');
        const messages = {{ slideshow_messages | tojson }};
        const interval = {{ slideshow_interval }};
        const fadeDuration = {{ slideshow_fade_duration }};
        let currentIndex = 0;
        let lastSlideTime = Date.now();

        function changeSlide() {
            // Fade out
            heroTitle.classList.add('fade-out');

            setTimeout(() => {
                // Change text
                currentIndex = (currentIndex + 1) % messages.length;
                heroTitle.textContent = messages[currentIndex];

                // Fade in
                heroTitle.classList.remove('fade-out');
                heroTitle.classList.add('fade-in');

                setTimeout(() => {
                    heroTitle.classList.remove('fade-in');
                }, fadeDuration);
            }, fadeDuration);
        }

        // Use requestAnimationFrame for smooth background-safe slideshow
        function slideshowLoop() {
            const now = Date.now();
            if (now - lastSlideTime >= interval) {
                changeSlide();
                lastSlideTime = now;
            }
            requestAnimationFrame(slideshowLoop);
        }

        // Start slideshow
        requestAnimationFrame(slideshowLoop);

        // Gallery Lightbox
        const images = [
            '{{ url_for('static', filename='image.png') }}',
            '{{ url_for('static', filename='image.png') }}',
            '{{ url_for('static', filename='image.png') }}',
            '{{ url_for('static', filename='image.png') }}'
        ];
        let currentImageIndex = 0;

        function openLightbox(index) {
            currentImageIndex = index;
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            lightboxImg.src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeLightboxOnBackground(event) {
            if (event.target.id === 'lightbox') {
                closeLightbox();
            }
        }

        function prevImage(event) {
            event.stopPropagation();
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            document.getElementById('lightbox-img').src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
        }

        function nextImage(event) {
            event.stopPropagation();
            currentImageIndex = (currentImageIndex + 1) % images.length;
            document.getElementById('lightbox-img').src = images[currentImageIndex];
            document.getElementById('current-index').textContent = currentImageIndex + 1;
        }

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', function(event) {
            const lightbox = document.getElementById('lightbox');
            if (!lightbox.classList.contains('active')) return;

            if (event.key === 'Escape') closeLightbox();
            if (event.key === 'ArrowLeft') prevImage(event);
            if (event.key === 'ArrowRight') nextImage(event);
        });

        // Scroll indicator visibility
        const scrollIndicator = document.getElementById('scroll-indicator');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 50) {
                scrollIndicator.classList.add('hidden');
            } else {
                scrollIndicator.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
